<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Riaz Profile Frame</title>
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    font-family: "Poppins", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #eceff1, #f5f5f5);
    padding: 20px;
  }
  .description {
    text-align: center;
    margin-bottom: 20px;
    max-width: 400px;
  }
  .description h2 { color:#1976d2; margin-bottom:10px;}
  .description p { color:#555; font-size:14px;}

  .frame-area {
    position: relative;
    width: 350px;  /* preview size */
    height: 350px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    background: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .frame-area img.bg-frame {
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    pointer-events:none;
    z-index:2;
  }
  .frame-area img.uploaded {
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    object-fit:cover;
    cursor:grab;
    z-index:1;
  }

  .controls { margin-top:20px; display:flex; flex-direction:column; gap:15px; align-items:center;}
  .upload-btn {
    padding:12px 24px; border:none; background:#1976d2; color:#fff;
    border-radius:8px; cursor:pointer; font-size:16px; font-weight:500;
  }
  .upload-btn:hover { background:#0d47a1; }
  input[type="file"] { display:none; }
  .download-btn {
    padding:12px 32px; border:none; background:#4caf50; color:#fff;
    border-radius:8px; cursor:pointer; font-size:16px; font-weight:500;
    display:none;
  }
  .download-btn.active { display:block; }
  .download-btn:hover { background:#388e3c; }
</style>
</head>
<body>

<div class="description">
  <h2>Facebook Profile Frame</h2>
  <p>This frame is created by Riaz for testing purposes. Upload your photo and adjust it for the best fit.</p>
</div>

<div class="frame-area" id="frame">
  <img src="frames/frame1.png" class="bg-frame" alt="Frame" crossorigin="anonymous">
</div>

<div class="controls">
  <label for="upload" class="upload-btn">Upload Photo</label>
  <input type="file" id="upload" accept="image/*">
  <button class="download-btn" id="downloadBtn">Download Frame</button>
</div>

<script>
const frame=document.getElementById('frame');
const uploadInput=document.getElementById('upload');
const downloadBtn=document.getElementById('downloadBtn');
let uploadedImg=null;

// Transform vars
let currentX=0, currentY=0, currentScale=1;
let isDragging=false, startX=0, startY=0;

// Upload photo
uploadInput.addEventListener('change', e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=function(ev){
    if(uploadedImg) uploadedImg.remove();
    uploadedImg=document.createElement('img');
    uploadedImg.src=ev.target.result;
    uploadedImg.classList.add('uploaded');
    frame.insertBefore(uploadedImg, frame.querySelector('.bg-frame'));
    downloadBtn.classList.add('active');
    currentX=0; currentY=0; currentScale=1;
    updateTransform();
  };
  reader.readAsDataURL(file);
});

function updateTransform(){
  if(!uploadedImg) return;
  uploadedImg.style.transform=`translate(${currentX}px,${currentY}px) scale(${currentScale})`;
}

// Drag desktop
frame.addEventListener('mousedown', e=>{
  if(!uploadedImg || e.target.classList.contains('bg-frame')) return;
  isDragging=true;
  startX = e.clientX - currentX;
  startY = e.clientY - currentY;
  uploadedImg.style.cursor='grabbing';
});
document.addEventListener('mousemove', e=>{
  if(!isDragging || !uploadedImg) return;
  currentX=e.clientX - startX;
  currentY=e.clientY - startY;
  updateTransform();
});
document.addEventListener('mouseup', ()=>{
  isDragging=false;
  if(uploadedImg) uploadedImg.style.cursor='grab';
});

// Drag touch
frame.addEventListener('touchstart', e=>{
  if(!uploadedImg) return;
  if(e.touches.length===1){
    const touch=e.touches[0];
    isDragging=true;
    startX=touch.clientX - currentX;
    startY=touch.clientY - currentY;
  } else if(e.touches.length===2){
    e.preventDefault();
    const t1=e.touches[0], t2=e.touches[1];
    initialDistance = Math.hypot(t2.clientX-t1.clientX, t2.clientY-t1.clientY);
    initialScale=currentScale;
  }
});
document.addEventListener('touchmove', e=>{
  if(!uploadedImg) return;
  if(isDragging && e.touches.length===1){
    const touch=e.touches[0];
    currentX=touch.clientX-startX;
    currentY=touch.clientY-startY;
    updateTransform();
  } else if(e.touches.length===2){
    e.preventDefault();
    const t1=e.touches[0], t2=e.touches[1];
    const newDist=Math.hypot(t2.clientX-t1.clientX, t2.clientY-t1.clientY);
    currentScale=initialScale*(newDist/initialDistance);
    if(currentScale<0.5) currentScale=0.5;
    if(currentScale>3) currentScale=3;
    updateTransform();
  }
});
document.addEventListener('touchend', ()=>{ isDragging=false; });

// Download high-res 2400x2400
downloadBtn.addEventListener('click', async ()=>{
  if(!uploadedImg) return;
  const canvas=document.createElement('canvas');
  canvas.width=2400;
  canvas.height=2400;
  const ctx=canvas.getContext('2d');

  const scaleFactor=2400/350;

  const img=new Image();
  img.src=uploadedImg.src;
  await new Promise(res=>img.onload=res);
  ctx.save();
  ctx.translate(1200,1200);
  ctx.translate(currentX*scaleFactor,currentY*scaleFactor);
  ctx.scale(currentScale*scaleFactor,currentScale*scaleFactor);
  ctx.drawImage(img,-175,-175,350,350);
  ctx.restore();

  const frameImg=new Image();
  frameImg.src='frames/frame1.png';
  await new Promise(res=>frameImg.onload=res);
  ctx.drawImage(frameImg,0,0,2400,2400);

  canvas.toBlob(blob=>{
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url; a.download='profile-frame-by-riaz.png';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  },'image/png');
});
</script>
</body>
</html>
